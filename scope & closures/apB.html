<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Appendix B: Polyfilling Block Scope - You don't know JS</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li><a href="../index.html"><strong aria-hidden="true">1.</strong> README</a></li><li><a href="../preface.html"><strong aria-hidden="true">2.</strong> Preface</a></li><li><a href="../up & going/toc.html"><strong aria-hidden="true">3.</strong> Up &amp; Going</a></li><li><ol class="section"><li><a href="../up & going/foreword.html"><strong aria-hidden="true">3.1.</strong> Foreword</a></li><li><a href="../up & going/ch1.html"><strong aria-hidden="true">3.2.</strong> Chapter 1: Into Programming</a></li><li><a href="../up & going/ch2.html"><strong aria-hidden="true">3.3.</strong> Chapter 2: Into JavaScript</a></li><li><a href="../up & going/ch3.html"><strong aria-hidden="true">3.4.</strong> Chapter 3: Into YDKJS</a></li><li><a href="../up & going/apA.html"><strong aria-hidden="true">3.5.</strong> Appendix A: Thank You's!</a></li></ol></li><li><a href="../scope & closures/toc.html"><strong aria-hidden="true">4.</strong> Scope &amp; Closures</a></li><li><ol class="section"><li><a href="../scope & closures/ch1.html"><strong aria-hidden="true">4.1.</strong> Chapter 1: What is Scope?</a></li><li><a href="../scope & closures/ch2.html"><strong aria-hidden="true">4.2.</strong> Chapter 2: Lexical Scope</a></li><li><a href="../scope & closures/ch3.html"><strong aria-hidden="true">4.3.</strong> Chapter 3: Function vs. Block Scope</a></li><li><a href="../scope & closures/ch4.html"><strong aria-hidden="true">4.4.</strong> Chapter 4: Hoisting</a></li><li><a href="../scope & closures/ch5.html"><strong aria-hidden="true">4.5.</strong> Chapter 5: Scope Closures</a></li><li><a href="../scope & closures/apA.html"><strong aria-hidden="true">4.6.</strong> Appendix A: Dynamic Scope</a></li><li><a href="../scope & closures/apB.html" class="active"><strong aria-hidden="true">4.7.</strong> Appendix B: Polyfilling Block Scope</a></li><li><a href="../scope & closures/apC.html"><strong aria-hidden="true">4.8.</strong> Appendix C: Lexical-this</a></li><li><a href="../scope & closures/apD.html"><strong aria-hidden="true">4.9.</strong> Appendix D: Thank You's!</a></li></ol></li><li><a href="../this & object prototypes/toc.html"><strong aria-hidden="true">5.</strong> this &amp; Object Prototypes</a></li><li><ol class="section"><li><a href="../this & object prototypes/foreword.html"><strong aria-hidden="true">5.1.</strong> Foreword</a></li><li><a href="../this & object prototypes/ch1.html"><strong aria-hidden="true">5.2.</strong> Chapter 1: this Or That?</a></li><li><a href="../this & object prototypes/ch2.html"><strong aria-hidden="true">5.3.</strong> Chapter 2: this All Makes Sense Now!</a></li><li><a href="../this & object prototypes/ch3.html"><strong aria-hidden="true">5.4.</strong> Chapter 3: Objects</a></li><li><a href="../this & object prototypes/ch4.html"><strong aria-hidden="true">5.5.</strong> Chapter 4: Mixing (Up) &quot;Class&quot; Objects</a></li><li><a href="../this & object prototypes/ch5.html"><strong aria-hidden="true">5.6.</strong> Chapter 5: Prototypes</a></li><li><a href="../this & object prototypes/ch6.html"><strong aria-hidden="true">5.7.</strong> Chapter 6: Behavior Delegation</a></li><li><a href="../this & object prototypes/apA.html"><strong aria-hidden="true">5.8.</strong> Appendix A: ES6 class</a></li><li><a href="../this & object prototypes/apB.html"><strong aria-hidden="true">5.9.</strong> Appendix B: Thank You's!</a></li></ol></li><li><a href="../types & grammar/toc.html"><strong aria-hidden="true">6.</strong> Types &amp; Grammar</a></li><li><ol class="section"><li><a href="../types & grammar/foreword.html"><strong aria-hidden="true">6.1.</strong> Foreword</a></li><li><a href="../types & grammar/ch1.html"><strong aria-hidden="true">6.2.</strong> Chapter 1: Types</a></li><li><a href="../types & grammar/ch2.html"><strong aria-hidden="true">6.3.</strong> Chapter 2: Values</a></li><li><a href="../types & grammar/ch3.html"><strong aria-hidden="true">6.4.</strong> Chapter 3: Natives</a></li><li><a href="../types & grammar/ch4.html"><strong aria-hidden="true">6.5.</strong> Chapter 4: Coercion</a></li><li><a href="../types & grammar/ch5.html"><strong aria-hidden="true">6.6.</strong> Chapter 5: Grammar</a></li><li><a href="../types & grammar/apA.html"><strong aria-hidden="true">6.7.</strong> Appendix A: Mixed Environment JavaScript</a></li><li><a href="../types & grammar/apB.html"><strong aria-hidden="true">6.8.</strong> Appendix B: Thank You's!</a></li></ol></li><li><a href="../async & performance/toc.html"><strong aria-hidden="true">7.</strong> Async &amp; Performance</a></li><li><ol class="section"><li><a href="../async & performance/foreword.html"><strong aria-hidden="true">7.1.</strong> Foreword</a></li><li><a href="../async & performance/ch1.html"><strong aria-hidden="true">7.2.</strong> Chapter 1: Asynchrony: Now &amp; Later</a></li><li><a href="../async & performance/ch2.html"><strong aria-hidden="true">7.3.</strong> Chapter 2: Callbacks</a></li><li><a href="../async & performance/ch3.html"><strong aria-hidden="true">7.4.</strong> Chapter 3: Promises</a></li><li><a href="../async & performance/ch4.html"><strong aria-hidden="true">7.5.</strong> Chapter 4: Generators</a></li><li><a href="../async & performance/ch5.html"><strong aria-hidden="true">7.6.</strong> Chapter 5: Program Performance</a></li><li><a href="../async & performance/ch6.html"><strong aria-hidden="true">7.7.</strong> Chapter 6: Benchmarking &amp; Tuning</a></li><li><a href="../async & performance/apA.html"><strong aria-hidden="true">7.8.</strong> Appendix A: Library: asynquence</a></li><li><a href="../async & performance/apB.html"><strong aria-hidden="true">7.9.</strong> Appendix B: Advanced Async Patterns</a></li><li><a href="../async & performance/apC.html"><strong aria-hidden="true">7.10.</strong> Appendix C: Thank You's!</a></li></ol></li><li><a href="../es6 & beyond/toc.html"><strong aria-hidden="true">8.</strong> ES6 &amp; Beyond</a></li><li><ol class="section"><li><a href="../es6 & beyond/foreword.html"><strong aria-hidden="true">8.1.</strong> Foreword</a></li><li><a href="../es6 & beyond/ch1.html"><strong aria-hidden="true">8.2.</strong> Chapter 1: ES? Now &amp; Future</a></li><li><a href="../es6 & beyond/ch2.html"><strong aria-hidden="true">8.3.</strong> Chapter 2: Syntax</a></li><li><a href="../es6 & beyond/ch3.html"><strong aria-hidden="true">8.4.</strong> Chapter 3: Organization</a></li><li><a href="../es6 & beyond/ch4.html"><strong aria-hidden="true">8.5.</strong> Chapter 4: Async Flow Control</a></li><li><a href="../es6 & beyond/ch5.html"><strong aria-hidden="true">8.6.</strong> Chapter 5: Collections</a></li><li><a href="../es6 & beyond/ch6.html"><strong aria-hidden="true">8.7.</strong> Chapter 6: API Additions</a></li><li><a href="../es6 & beyond/ch7.html"><strong aria-hidden="true">8.8.</strong> Chapter 7: Meta Programming</a></li><li><a href="../es6 & beyond/ch8.html"><strong aria-hidden="true">8.9.</strong> Chapter 8: Beyond ES6</a></li><li><a href="../es6 & beyond/apA.html"><strong aria-hidden="true">8.10.</strong> Appendix A: Thank You's!</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">You don't know JS</h1>

                        <div class="right-buttons">
                            <a href="../print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#you-dont-know-js-scope--closures" id="you-dont-know-js-scope--closures">You Don't Know JS: Scope &amp; Closures</a></h1>
<h1><a class="header" href="#appendix-b-polyfilling-block-scope" id="appendix-b-polyfilling-block-scope">Appendix B: Polyfilling Block Scope</a></h1>
<p>In Chapter 3, we explored Block Scope. We saw that <code>with</code> and the <code>catch</code> clause are both tiny examples of block scope that have existed in JavaScript since at least the introduction of ES3.</p>
<p>But it's ES6's introduction of <code>let</code> that finally gives full, unfettered block-scoping capability to our code. There are many exciting things, both functionally and code-stylistically, that block scope will enable.</p>
<p>But what if we wanted to use block scope in pre-ES6 environments?</p>
<p>Consider this code:</p>
<pre><code class="language-js">{
	let a = 2;
	console.log( a ); // 2
}

console.log( a ); // ReferenceError
</code></pre>
<p>This will work great in ES6 environments. But can we do so pre-ES6? <code>catch</code> is the answer.</p>
<pre><code class="language-js">try{throw 2}catch(a){
	console.log( a ); // 2
}

console.log( a ); // ReferenceError
</code></pre>
<p>Whoa! That's some ugly, weird looking code. We see a <code>try/catch</code> that appears to forcibly throw an error, but the &quot;error&quot; it throws is just a value <code>2</code>, and then the variable declaration that receives it is in the <code>catch(a)</code> clause. Mind: blown.</p>
<p>That's right, the <code>catch</code> clause has block-scoping to it, which means it can be used as a polyfill for block scope in pre-ES6 environments.</p>
<p>&quot;But...&quot;, you say. &quot;...no one wants to write ugly code like that!&quot; That's true. No one writes (some of) the code output by the CoffeeScript compiler, either. That's not the point.</p>
<p>The point is that tools can transpile ES6 code to work in pre-ES6 environments. You can write code using block-scoping, and benefit from such functionality, and let a build-step tool take care of producing code that will actually <em>work</em> when deployed.</p>
<p>This is actually the preferred migration path for all (ahem, most) of ES6: to use a code transpiler to take ES6 code and produce ES5-compatible code during the transition from pre-ES6 to ES6.</p>
<h2><a class="header" href="#traceur" id="traceur">Traceur</a></h2>
<p>Google maintains a project called &quot;Traceur&quot; <sup class="footnote-reference"><a href="#note-traceur">1</a></sup>, which is exactly tasked with transpiling ES6 features into pre-ES6 (mostly ES5, but not all!) for general usage. The TC39 committee relies on this tool (and others) to test out the semantics of the features they specify.</p>
<p>What does Traceur produce from our snippet? You guessed it!</p>
<pre><code class="language-js">{
	try {
		throw undefined;
	} catch (a) {
		a = 2;
		console.log( a );
	}
}

console.log( a );
</code></pre>
<p>So, with the use of such tools, we can start taking advantage of block scope regardless of if we are targeting ES6 or not, because <code>try/catch</code> has been around (and worked this way) from ES3 days.</p>
<h2><a class="header" href="#implicit-vs-explicit-blocks" id="implicit-vs-explicit-blocks">Implicit vs. Explicit Blocks</a></h2>
<p>In Chapter 3, we identified some potential pitfalls to code maintainability/refactorability when we introduce block-scoping. Is there another way to take advantage of block scope but to reduce this downside?</p>
<p>Consider this alternate form of <code>let</code>, called the &quot;let block&quot; or &quot;let statement&quot; (contrasted with &quot;let declarations&quot; from before).</p>
<pre><code class="language-js">let (a = 2) {
	console.log( a ); // 2
}

console.log( a ); // ReferenceError
</code></pre>
<p>Instead of implicitly hijacking an existing block, the let-statement creates an explicit block for its scope binding. Not only does the explicit block stand out more, and perhaps fare more robustly in code refactoring, it produces somewhat cleaner code by, grammatically, forcing all the declarations to the top of the block. This makes it easier to look at any block and know what's scoped to it and not.</p>
<p>As a pattern, it mirrors the approach many people take in function-scoping when they manually move/hoist all their <code>var</code> declarations to the top of the function. The let-statement puts them there at the top of the block by intent, and if you don't use <code>let</code> declarations strewn throughout, your block-scoping declarations are somewhat easier to identify and maintain.</p>
<p>But, there's a problem. The let-statement form is not included in ES6. Neither does the official Traceur compiler accept that form of code.</p>
<p>We have two options. We can format using ES6-valid syntax and a little sprinkle of code discipline:</p>
<pre><code class="language-js">/*let*/ { let a = 2;
	console.log( a );
}

console.log( a ); // ReferenceError
</code></pre>
<p>But, tools are meant to solve our problems. So the other option is to write explicit let statement blocks, and let a tool convert them to valid, working code.</p>
<p>So, I built a tool called &quot;let-er&quot; <sup class="footnote-reference"><a href="#note-let_er">2</a></sup> to address just this issue. <em>let-er</em> is a build-step code transpiler, but its only task is to find let-statement forms and transpile them. It will leave alone any of the rest of your code, including any let-declarations. You can safely use <em>let-er</em> as the first ES6 transpiler step, and then pass your code through something like Traceur if necessary.</p>
<p>Moreover, <em>let-er</em> has a configuration flag <code>--es6</code>, which when turned on (off by default), changes the kind of code produced. Instead of the <code>try/catch</code> ES3 polyfill hack, <em>let-er</em> would take our snippet and produce the fully ES6-compliant, non-hacky:</p>
<pre><code class="language-js">{
	let a = 2;
	console.log( a );
}

console.log( a ); // ReferenceError
</code></pre>
<p>So, you can start using <em>let-er</em> right away, and target all pre-ES6 environments, and when you only care about ES6, you can add the flag and instantly target only ES6.</p>
<p>And most importantly, <strong>you can use the more preferable and more explicit let-statement form</strong> even though it is not an official part of any ES version (yet).</p>
<h2><a class="header" href="#performance" id="performance">Performance</a></h2>
<p>Let me add one last quick note on the performance of <code>try/catch</code>, and/or to address the question, &quot;why not just use an IIFE to create the scope?&quot;</p>
<p>Firstly, the performance of <code>try/catch</code> <em>is</em> slower, but there's no reasonable assumption that it <em>has</em> to be that way, or even that it <em>always will be</em> that way. Since the official TC39-approved ES6 transpiler uses <code>try/catch</code>, the Traceur team has asked Chrome to improve the performance of <code>try/catch</code>, and they are obviously motivated to do so.</p>
<p>Secondly, IIFE is not a fair apples-to-apples comparison with <code>try/catch</code>, because a function wrapped around any arbitrary code changes the meaning, inside of that code, of <code>this</code>, <code>return</code>, <code>break</code>, and <code>continue</code>. IIFE is not a suitable general substitute. It could only be used manually in certain cases.</p>
<p>The question really becomes: do you want block-scoping, or not. If you do, these tools provide you that option. If not, keep using <code>var</code> and go on about your coding!</p>
<div class="footnote-definition" id="note-traceur"><sup class="footnote-definition-label">1</sup>
<p><a href="http://google.github.io/traceur-compiler/demo/repl.html">Google Traceur</a></p>
</div>
<p><sup class="footnote-reference"><a href="#note-let_er">2</a></sup>: <a href="https://github.com/getify/let-er">let-er</a></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../scope &amp; closures/apA.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../scope &amp; closures/apC.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../scope &amp; closures/apA.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../scope &amp; closures/apC.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
